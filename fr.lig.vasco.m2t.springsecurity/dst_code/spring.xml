<?xml version="1.0" encoding="UTF-8"?>
<b:beans xmlns:b="http://www.springframework.org/schema/beans"

	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.springframework.org/schema/security"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
	http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	http://www.springframework.org/schema/security 
	http://www.springframework.org/schema/security/spring-security.xsd">

<!--*************************************************************************************************
! SpringSecurity configuration file automatically generated by VASCO Team at 2016-08-22 23:52:16.531
!****************************************************************************************************-->

<!--
! Make sure that the references : Roleoperations, Secureuml and webapplication in the ActionRoles' Model are already setted
! The referenced models should be loaded by the "load resource" menu item : right-click on the model >> load resource >> browse workspace 
-->

<!-- Definition of URL interception -->

	<http disable-url-rewriting="false" auto-config="true"
		use-expressions="true" access-decision-manager-ref="accessDecisionManager">
		<headers disabled="true" />
		<csrf disabled="true" />

        <intercept-url pattern="/login" 
                 access="permitAll" /> 
        <intercept-url pattern="/*" 
                 access="hasAnyRole('ROLE_USER')" />
        <intercept-url pattern="/patient/details" 
                 access="hasAnyRole()" />
        <intercept-url pattern="/medicalrecord/delete" 
                 access="hasAnyRole()" />
        <intercept-url pattern="/medicalrecord/edit" 
                 access="hasAnyRole('ROLE_DOCTOR')" />
        <intercept-url pattern="/medicalrecord/details" 
                 access="hasAnyRole('ROLE_MEDICALSTAFF')" />
        <intercept-url pattern="/patient/edit" 
                 access="hasAnyRole('ROLE_SECRETARY', 'ROLE_NURSE', 'ROLE_MEDICALSTAFF', 'ROLE_DOCTOR')" />
        <intercept-url pattern="/medicalrecord/list" 
                 access="hasAnyRole('ROLE_MEDICALSTAFF')" />
        <intercept-url pattern="/medicalrecord/validate" 
                 access="hasAnyRole('ROLE_DOCTOR')" />
        <intercept-url pattern="/patient/delete" 
                 access="hasAnyRole()" />
        <intercept-url pattern="/patient/new" 
                 access="hasAnyRole('ROLE_SECRETARY')" />
        <intercept-url pattern="/patient/list" 
                 access="hasAnyRole()" />
        <intercept-url pattern="/medicalrecord/new" 
                 access="hasAnyRole('ROLE_NURSE')" />

		<form-login login-page="/login" username-parameter="ssoId"
			password-parameter="password" authentication-failure-url="/Access_Denied" />
		<logout invalidate-session="true" logout-url="/logout"
			delete-cookies="*" logout-success-url="/" />
	</http>	

   
   
   


<!-- Definition of USERS and USER ASSIGNMENTS -->

	<authentication-manager>
		<authentication-provider>
			<user-service>
<user name="Marie" password="password" 
      authorities="ROLE_SECRETARY" />
<user name="Martin" password="password" 
      authorities="ROLE_NURSE" />
<user name="Peter" password="password" 
      authorities="ROLE_DOCTOR" />
			</user-service>
		</authentication-provider>
	</authentication-manager>


<!-- Definition of ROLES and ROLES HIERARCHY -->

	<b:bean id="accessDecisionManager"
		class="org.springframework.security.access.vote.AffirmativeBased">
		<b:constructor-arg name="decisionVoters">
			<b:list>
				<b:ref bean="webExpressionVoter" />
				<b:ref bean="roleHierarchyVoter" />
				<b:ref bean="authenticatedVoter" />
			</b:list>
		</b:constructor-arg>
	</b:bean>

	<b:bean id="authenticatedVoter"
		class="org.springframework.security.access.vote.AuthenticatedVoter" />

	<b:bean id="roleHierarchyVoter"
		class="org.springframework.security.access.vote.RoleHierarchyVoter">
		<b:constructor-arg ref="roleHierarchy" />
	</b:bean>

	<!-- <global-method-security pre-post-annotations="enabled"> <expression-handler 
		ref="expressionHandler" /> </global-method-security> -->

	<b:bean id="webExpressionVoter"
		class="org.springframework.security.web.access.expression.WebExpressionVoter">
		<b:property name="expressionHandler">
			<b:bean
				class="org.springframework.security.web.access.expression.DefaultWebSecurityExpressionHandler">
				<b:property name="roleHierarchy" ref="roleHierarchy" />
			</b:bean>
		</b:property>
	</b:bean>

	<b:bean id="defaultMethodSecurityExpressionHandler"
		class="org.springframework.security.access.expression.method.DefaultMethodSecurityExpressionHandler">
		<b:property name="roleHierarchy" ref="roleHierarchy" />
	</b:bean>

	<b:bean id="roleHierarchy"
		class="org.springframework.security.access.hierarchicalroles.RoleHierarchyImpl">
		<b:property name="hierarchy">
			<b:value>              
ROLE_DOCTOR 
     > ROLE_MEDICALSTAFF
ROLE_NURSE 
     > ROLE_MEDICALSTAFF
ROLE_SECRETARY 
ROLE_MEDICALSTAFF 
            </b:value>
		</b:property>
	</b:bean>
</b:beans>
